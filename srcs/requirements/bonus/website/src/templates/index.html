<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inception Docker Structure</title>
  <style>
    :root{
      --card-bg:#ffffff;
      --card-border:#e3e7ee;
      --accent:#2b7be4;
      --muted:#6b7280;
      --shadow: 0 6px 18px rgba(27,40,60,0.08);
    }
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#f6f8fb 0%, #ffffff 100%);
      color:#0f1724;
      margin:0;
      padding:28px;
    }
    .container{
      max-width:1000px;
      margin:0 auto;
    }
    h1{ margin: 0 0 10px 0; font-size:20px; }
    p.lead{ color:var(--muted); margin-top:6px; }

    /* layout */
    .diagram{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:24px;
      align-items:center;
      margin-top:26px;
      position:relative;
      min-height:240px;
    }

    .card{
      background:var(--card-bg);
      border:1px solid var(--card-border);
      border-radius:12px;
      padding:16px;
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:96px;
      justify-content:center;
    }
    .card .title{ font-weight:600; font-size:16px; display:flex; align-items:center; gap:8px; }
    .card .role{ color:var(--muted); font-size:13px; }
    .badge{ background:rgba(43,123,228,0.08); color:var(--accent); padding:4px 8px; border-radius:999px; font-weight:600; font-size:12px; }

    /* positions for arrows (simple) */
    .col-left{ grid-column: 1; }
    .col-center{ grid-column: 2; }
    .col-right{ grid-column: 3; }

    /* small table for properties */
    .props{ font-size:13px; color:#111827; }
    .props li{ margin:6px 0; color:var(--muted); font-size:13px; }

    /* arrows using inline SVG container */
    .svg-overlay{
      position:absolute;
      inset:0;
      pointer-events:none;
    }

    footer{ margin-top:18px; font-size:13px; color:var(--muted); }
    ul.notes{ margin:10px 0 0 0; padding-left:18px; color:var(--muted); }
    @media (max-width:820px){
      .diagram{ grid-template-columns: 1fr; gap:14px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Inception Docker — Service Map</h1>
    <p class="lead">Visual representation of your Docker services and connections.</p>

    <div class="diagram" id="diagram">
      <!-- Left: nginx -->
      <div class="card col-left" id="svc-nginx">
        <div class="title">
          <span class="badge">nginx</span>
          <span>reverse-proxy</span>
        </div>
        <div class="role">listens & proxies TLS</div>
        <ul class="props">
          <li><strong>Ports:</strong> 8443 → 443</li>
          <li><strong>Forwards to:</strong> wordpress:9000</li>
        </ul>
      </div>

      <!-- Center: wordpress -->
      <div class="card col-center" id="svc-wordpress">
        <div class="title">
          <span class="badge">wordpress</span>
          <span>php-fpm / app</span>
        </div>
        <div class="role">serves PHP via php-fpm (container port 9000)</div>
        <ul class="props">
          <li><strong>Ports:</strong> 9000</li>
          <li><strong>Depends on:</strong> mariadb</li>
        </ul>
      </div>

      <!-- Right: mariadb -->
      <div class="card col-right" id="svc-mariadb">
        <div class="title">
          <span class="badge">mariadb</span>
          <span>database</span>
        </div>
        <div class="role">persistent DB data (volumes)</div>
        <ul class="props">
          <li><strong>Volume(s):</strong> /var/lib/mysql (persisted)</li>
          <li><strong>Notes:</strong> backup & permissions important</li>
        </ul>
      </div>

      <!-- Additional: FTP (below) -->
      <div class="card" style="grid-column:1 / -1; margin-top:14px;" id="svc-ftp">
        <div class="title">
          <span class="badge">ftp</span>
          <span>ftpd</span>
        </div>
        <div class="role">file transfer</div>
        <ul class="props">
          <li><strong>Ports:</strong> 2121 → 21 (host:container)</li>
          <li><strong>Notes:</strong> configure passive ports and firewall</li>
        </ul>
      </div>

    </div>

    <footer>
      <strong>Network:</strong> docker-network &nbsp; · &nbsp;
      <strong>Notes:</strong>
      <ul class="notes">
        {% for n in stack.notes %}
          <li>{{ n }}</li>
        {% endfor %}
      </ul>
    </footer>
  </div>

  <script>
    // Simple arrow-drawing between elements. Works responsively.
    function drawArrows(){
      const svg = document.querySelector('.svg-overlay');
      const g = document.getElementById('arrows');
      g.innerHTML = ''; // clear

      // helper: get center point of element relative to svg
      function center(el){
        const r = el.getBoundingClientRect();
        const svgR = svg.getBoundingClientRect();
        const x = (r.left + r.right)/2 - svgR.left;
        const y = (r.top + r.bottom)/2 - svgR.top;
        return {x,y};
      }

      const nginx = document.getElementById('svc-nginx');
      const wp = document.getElementById('svc-wordpress');
      const mariadb = document.getElementById('svc-mariadb');

      if(!nginx || !wp || !mariadb) return;

      const a = center(nginx);
      const b = center(wp);
      const c = center(mariadb);

      // draw curve nginx -> wordpress
      const path1 = document.createElementNS('http://www.w3.org/2000/svg','path');
      const mid1x = (a.x + b.x)/2;
      const d1 = `M ${a.x} ${a.y} C ${mid1x} ${a.y} ${mid1x} ${b.y} ${b.x} ${b.y}`;
      path1.setAttribute('d', d1);
      path1.setAttribute('stroke-linecap','round');
      g.appendChild(path1);

      // draw curve wordpress -> mariadb
      const path2 = document.createElementNS('http://www.w3.org/2000/svg','path');
      const mid2x = (b.x + c.x)/2;
      const d2 = `M ${b.x} ${b.y} C ${mid2x} ${b.y} ${mid2x} ${c.y} ${c.x} ${c.y}`;
      path2.setAttribute('d', d2);
      path2.setAttribute('stroke-linecap','round');
      g.appendChild(path2);
    }

    // initial draw + redraw on resize
    window.addEventListener('load', drawArrows);
    window.addEventListener('resize', () => {
      // small debounce
      clearTimeout(window._arrowTimer);
      window._arrowTimer = setTimeout(drawArrows, 120);
    });
  </script>
</body>
</html>

